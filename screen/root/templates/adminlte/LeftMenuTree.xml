<?xml version="1.0" encoding="UTF-8"?>

<screen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://moqui.org/xsd/xml-screen-2.0.xsd"
	require-authentication="false" default-menu-include="false">

	<actions>
		<set field="parentScreenDef" from="currentScreenDef" />
		<set field="parentScreenPath" from="currentScreenPath" />
	</actions>
	<widgets>

		<section-iterate name="ScreenNestedSection" list="showAll == 'true' ? parentScreenDef.getSubscreensItemsSorted() : parentScreenDef.getMenuSubscreensItems()"
			entry="currentSubscreensItem">
			<actions>
				<set field="currentScreenDef" from="sri.sfi.getScreenDefinition(currentSubscreensItem.location)" />
				<set field="currentScreenPath" value="${parentScreenPath}/${currentSubscreensItem.name}" />
				<set field="currentUrlInfo" from="sri.buildUrl(currentScreenPath)" />
				<set field="subMenus" from="currentScreenDef.getMenuSubscreensItems()" />
				<set field="subMenuNum" from="0" />
				<iterate entry="subscreensItem" list="subMenus">

					<set field="subscreensItemDef" from="sri.sfi.getScreenDefinition(subscreensItem.location)" />

					<set field="subscreensItemUrlInfo" from="sri.buildUrl(currentScreenPath+'/'+subscreensItem.name)" />

					<if condition="subscreensItemDef != null &amp;&amp; subscreensItemUrlInfo?.isPermitted() &amp;&amp; (showAll == 'true' || !subscreensItemDef?.hasRequiredParameters())">

						<if condition="!subscreensItemDef?.hasRequiredParameters()">
							<set field="subMenuNum" from="subMenuNum + 1" />
						</if>
					</if>

				</iterate>
			</actions>
			<widgets>
				<section name="ScreenItemRender">
					<condition>
						<expression>currentScreenDef != null &amp;&amp; currentUrlInfo?.isPermitted() &amp;&amp; (showAll == 'true' || !currentScreenDef?.hasRequiredParameters())</expression>
					</condition>
					<widgets>
						<section name="LinkOrLabel">
							<condition>
								<expression>!currentScreenDef?.hasRequiredParameters()</expression>
							</condition>
							<widgets>
								<left-tree-nodes subMenuNum="${subMenuNum}" currentScreenPath="${currentScreenPath}" url="${currentUrlInfo.url}"
									text="${currentSubscreensItem.menuTitle}">

									<include-screen location="component://root/screen/root/templates/adminlte/LeftSubMenuTree.xml" share-scope="false" />
								</left-tree-nodes>
							</widgets>
							<fail-widgets><!-- <label text="${currentSubscreensItem.menuTitle}" style="text-muted"/> -->
							</fail-widgets>
						</section>


					</widgets>
					<fail-widgets>
						<render-mode>
							<text type="html"><![CDATA[<!-- excluding screen at path ${currentScreenPath} -->]]></text>
						</render-mode>
					</fail-widgets>
				</section>
			</widgets>
		</section-iterate>

	</widgets>
</screen>
